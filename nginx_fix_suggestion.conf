# ä¿®å¤åçš„Nginxé…ç½®å»ºè®®
# åœ¨ location /api/ å—ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š

location /api/ {
    proxy_pass http://pkb_test_backend;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;  # å·²æœ‰ï¼Œå¾ˆå¥½
    
    # ğŸ”§ æ·»åŠ ä»¥ä¸‹é…ç½®æ¥ä¿®å¤é‡å®šå‘é—®é¢˜ï¼š
    proxy_redirect http://pkb-test.kmchat.cloud/ https://pkb-test.kmchat.cloud/;
    proxy_redirect http://$host/ https://$host/;
    
    # ğŸ”§ æˆ–è€…ä½¿ç”¨æ›´é€šç”¨çš„é…ç½®ï¼š
    # proxy_redirect ~^http://([^/]+)(.*)$ https://$1$2;
    
    # ğŸ”§ ç¡®ä¿FastAPIçŸ¥é“åŸå§‹åè®®
    proxy_set_header X-Forwarded-Ssl on;
    proxy_set_header X-Url-Scheme $scheme;
}
