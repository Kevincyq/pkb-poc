# PKB ç»Ÿä¸€ç”¨æˆ·ä½“éªŒè®¾è®¡æ–¹æ¡ˆ

## ğŸ¯ æ ¸å¿ƒç†å¿µ

**"PKB åŸç”Ÿè´¦å·ï¼Œå¤šæºæ•°æ®é›†æˆï¼ŒAI é©±åŠ¨ä½“éªŒ"**

ç”¨æˆ·ä½¿ç”¨ PKB ç‹¬ç«‹è´¦å·ç³»ç»Ÿï¼Œé€šè¿‡ç»Ÿä¸€çš„æ™ºèƒ½ç•Œé¢ç®¡ç†æ‰€æœ‰çŸ¥è¯†ã€‚æ•°æ®æ¥æºå¯ä»¥æ˜¯ WebUI ä¸Šä¼ ã€Nextcloud åŒæ­¥ã€æˆ–å…¶ä»–äº‘ç›˜é›†æˆï¼Œéƒ½èƒ½è·å¾—ä¸€è‡´çš„ AI é©±åŠ¨ä½“éªŒã€‚

## ğŸ—ï¸ ç»Ÿä¸€ä½“éªŒæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç»Ÿä¸€ç”¨æˆ·ç•Œé¢å±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ğŸŒ PKB Web Dashboard (ç»Ÿä¸€å…¥å£)                               â”‚
â”‚  â”‚                                                             â”‚
â”‚  â”œâ”€â”€ ğŸ‘¤ ç”¨æˆ·è´¦å· (PKB åŸç”Ÿè®¤è¯ç³»ç»Ÿ)                            â”‚
â”‚  â”œâ”€â”€ ğŸ“ æ–‡ä»¶æµè§ˆ (æ‰€æœ‰æ¥æºç»Ÿä¸€æ˜¾ç¤º)                            â”‚
â”‚  â”œâ”€â”€ ğŸ” æ™ºèƒ½æœç´¢ (è·¨æ¥æºè¯­ä¹‰æœç´¢)                              â”‚
â”‚  â”œâ”€â”€ ğŸ¤– AI é—®ç­” (åŸºäºå…¨é‡çŸ¥è¯†åº“)                               â”‚
â”‚  â””â”€â”€ ğŸ“Š çŸ¥è¯†æ´å¯Ÿ (ç»Ÿè®¡åˆ†æ + å…³ç³»å›¾è°±)                         â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“± PKB Mobile App (åŒæ­¥ä½“éªŒ)                                  â”‚
â”‚  â”‚                                                             â”‚
â”‚  â”œâ”€â”€ ğŸ‘¤ åŒä¸€è´¦å·ç™»å½•                                           â”‚
â”‚  â”œâ”€â”€ ğŸ“ åŒæ ·çš„æ–‡ä»¶è§†å›¾                                         â”‚
â”‚  â”œâ”€â”€ ğŸ” åŒæ ·çš„æœç´¢ç»“æœ                                         â”‚
â”‚  â””â”€â”€ ğŸ¤– åŒæ ·çš„ AI åŠ©æ‰‹                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç»Ÿä¸€çŸ¥è¯†ç®¡ç†å±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ğŸ—„ï¸ ç»Ÿä¸€çŸ¥è¯†åº“ (PostgreSQL)                                    â”‚
â”‚  â”‚                                                             â”‚
â”‚  â”œâ”€â”€ ğŸ“„ Content è¡¨ (æ‰€æœ‰æ–‡æ¡£ç»Ÿä¸€å­˜å‚¨)                          â”‚
â”‚  â”‚   â”œâ”€â”€ user_id: ç”¨æˆ·éš”ç¦»                                    â”‚
â”‚  â”‚   â”œâ”€â”€ source_type: æ•°æ®æ¥æºç±»å‹ (è§ä¸‹æ–¹è¯¦ç»†å®šä¹‰)            â”‚
â”‚  â”‚   â”œâ”€â”€ source_uri: åŸå§‹æ•°æ®è·¯å¾„/URL                         â”‚
â”‚  â”‚   â”œâ”€â”€ source_metadata: æ¥æºç‰¹å®šå…ƒæ•°æ® (JSON)               â”‚
â”‚  â”‚   â”œâ”€â”€ sync_status: åŒæ­¥çŠ¶æ€                                â”‚
â”‚  â”‚   â””â”€â”€ crawl_config: çˆ¬å–é…ç½® (é’ˆå¯¹ç½‘é¡µç­‰)                 â”‚
â”‚  â”‚                                                             â”‚
â”‚  â”œâ”€â”€ ğŸ” å‘é‡ç´¢å¼• (è·¨æ¥æºè¯­ä¹‰æœç´¢)                              â”‚
â”‚  â”œâ”€â”€ ğŸ·ï¸ æ™ºèƒ½åˆ†ç±» (ç»Ÿä¸€åˆ†ç±»ä½“ç³»)                                â”‚
â”‚  â””â”€â”€ ğŸ’¬ å¯¹è¯å†å² (ç”¨æˆ·ä¸ªäººåŒ–)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¤šæºæ–‡ä»¶æ¥å…¥å±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â˜ï¸ Nextcloud é›†æˆ (å¯é€‰)                                      â”‚
â”‚  â”‚                                                             â”‚
â”‚  â”œâ”€â”€ ğŸ”— è´¦å·ç»‘å®š (å¯é€‰é›†æˆ)                                    â”‚
â”‚  â”œâ”€â”€ ğŸ“ æ–‡ä»¶å­˜å‚¨ + å¤šè®¾å¤‡åŒæ­¥                                  â”‚
â”‚  â”œâ”€â”€ ğŸ”„ WebDAV æ‰«æ + å¢é‡åŒæ­¥                                 â”‚
â”‚  â””â”€â”€ ğŸ“Š æ–‡ä»¶å…ƒæ•°æ® (ä¿®æ”¹æ—¶é—´ã€è®¾å¤‡ä¿¡æ¯ç­‰)                      â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“¤ WebUI æ¥å…¥                                                 â”‚
â”‚  â”‚                                                             â”‚
â”‚  â”œâ”€â”€ ğŸš€ å³æ—¶ä¸Šä¼  + å®æ—¶å¤„ç†                                    â”‚
â”‚  â”œâ”€â”€ ğŸ“ ç”¨æˆ·æ ‡æ³¨ + æ‰‹åŠ¨åˆ†ç±»                                    â”‚
â”‚  â”œâ”€â”€ ğŸ¯ ç²¾ç¡®æ§åˆ¶ + æ‰¹é‡æ“ä½œ                                    â”‚
â”‚  â””â”€â”€ ğŸ“Š ä¸Šä¼ å…ƒæ•°æ® (IPã€æ—¶é—´æˆ³ç­‰)                              â”‚
â”‚                                                                 â”‚
â”‚  ğŸ”Œ æ™ºèƒ½å·¥å…·ä¸æ•°æ®æ¥å…¥å±‚                                       â”‚
â”‚  â”‚                                                             â”‚
â”‚  â”œâ”€â”€ ğŸŒ Web æœç´¢ä¸çˆ¬å– (å®æ—¶æœç´¢ + å®šæœŸçˆ¬å–)                   â”‚
â”‚  â”œâ”€â”€ ğŸ› ï¸ MCP å·¥å…·ç½‘å…³ (ç»Ÿä¸€å·¥å…·è°ƒç”¨æ¥å£)                        â”‚
â”‚  â”œâ”€â”€ ğŸ“§ é‚®ä»¶é™„ä»¶è‡ªåŠ¨å¯¼å…¥                                       â”‚
â”‚  â”œâ”€â”€ ğŸ“± ç¬¬ä¸‰æ–¹åº”ç”¨é›†æˆ (å¾®ä¿¡ã€é’‰é’‰ç­‰)                          â”‚
â”‚  â”œâ”€â”€ ğŸ—‚ï¸ åº”ç”¨æ•°æ®åŒæ­¥ (ç¬”è®°åº”ç”¨ã€æ–‡æ¡£å·¥å…·)                      â”‚
â”‚  â”œâ”€â”€ ğŸ“Š æ•°æ®åº“è¿æ¥ (MySQLã€MongoDBç­‰)                          â”‚
â”‚  â”œâ”€â”€ ğŸ¤– è‡ªåŠ¨åŒ–å·¥å…·å¯¹æ¥ (Zapierã€IFTTT)                         â”‚
â”‚  â”œâ”€â”€ ğŸ“¡ RSS/è®¢é˜…æºç›‘å¬                                         â”‚
â”‚  â””â”€â”€ ğŸ™ï¸ è¯­éŸ³ä¸å¤šæ¨¡æ€è¾“å…¥ (Voice Memoã€SMSç­‰)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ—„ï¸ ç»Ÿä¸€æ•°æ®ç»“æ„è®¾è®¡

### æ ¸å¿ƒæ•°æ®æ¨¡å‹

#### 1. Content è¡¨ (å†…å®¹ä¸»è¡¨)
```sql
CREATE TABLE contents (
    -- åŸºç¡€å­—æ®µ
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id),
    title VARCHAR(500) NOT NULL,
    content TEXT,
    modality VARCHAR(20) NOT NULL CHECK (modality IN ('text', 'image', 'pdf', 'video', 'audio', 'webpage', 'email')),
    
    -- æ¥æºä¿¡æ¯
    source_type VARCHAR(50) NOT NULL CHECK (source_type IN (
        'nextcloud', 'webui', 'web_crawl', 'web_search', 'email', 'app_sync', 
        'database', 'rss', 'api', 'automation', 'mcp_tool', 'voice_memo', 'sms'
    )),
    source_uri TEXT NOT NULL, -- åŸå§‹æ•°æ®è·¯å¾„/URL
    source_metadata JSONB DEFAULT '{}', -- æ¥æºç‰¹å®šå…ƒæ•°æ®
    
    -- åŒæ­¥çŠ¶æ€
    sync_status VARCHAR(20) DEFAULT 'pending' CHECK (sync_status IN ('synced', 'pending', 'error', 'deleted')),
    last_sync_at TIMESTAMP WITH TIME ZONE,
    sync_error TEXT,
    
    -- çˆ¬å–é…ç½® (é’ˆå¯¹ç½‘é¡µç­‰åŠ¨æ€å†…å®¹)
    crawl_config JSONB DEFAULT '{}',
    next_crawl_at TIMESTAMP WITH TIME ZONE,
    crawl_frequency_hours INTEGER DEFAULT 24,
    
    -- AI å¤„ç†çŠ¶æ€
    processing_status VARCHAR(20) DEFAULT 'pending' CHECK (processing_status IN ('pending', 'processing', 'completed', 'failed')),
    ai_metadata JSONB DEFAULT '{}', -- AI åˆ†æç»“æœ
    
    -- æ—¶é—´æˆ³
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    deleted_at TIMESTAMP WITH TIME ZONE,
    
    -- ç´¢å¼•
    CONSTRAINT unique_user_source UNIQUE (user_id, source_uri)
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_contents_user_id ON contents(user_id);
CREATE INDEX idx_contents_source_type ON contents(source_type);
CREATE INDEX idx_contents_sync_status ON contents(sync_status);
CREATE INDEX idx_contents_processing_status ON contents(processing_status);
CREATE INDEX idx_contents_next_crawl ON contents(next_crawl_at) WHERE next_crawl_at IS NOT NULL;
CREATE INDEX idx_contents_source_metadata ON contents USING GIN (source_metadata);
```

#### 2. Data Sources è¡¨ (æ•°æ®æºé…ç½®)
```sql
CREATE TABLE data_sources (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id),
    
    -- æ•°æ®æºåŸºæœ¬ä¿¡æ¯
    name VARCHAR(200) NOT NULL,
    source_type VARCHAR(50) NOT NULL,
    description TEXT,
    is_active BOOLEAN DEFAULT true,
    
    -- è¿æ¥é…ç½®
    connection_config JSONB NOT NULL DEFAULT '{}', -- è¿æ¥å‚æ•°
    auth_config JSONB DEFAULT '{}', -- è®¤è¯ä¿¡æ¯ (åŠ å¯†å­˜å‚¨)
    
    -- åŒæ­¥é…ç½®
    sync_enabled BOOLEAN DEFAULT true,
    sync_frequency_hours INTEGER DEFAULT 24,
    last_sync_at TIMESTAMP WITH TIME ZONE,
    next_sync_at TIMESTAMP WITH TIME ZONE,
    
    -- è¿‡æ»¤å’Œå¤„ç†è§„åˆ™
    filter_rules JSONB DEFAULT '{}', -- å†…å®¹è¿‡æ»¤è§„åˆ™
    processing_rules JSONB DEFAULT '{}', -- å¤„ç†è§„åˆ™
    
    -- ç»Ÿè®¡ä¿¡æ¯
    total_items INTEGER DEFAULT 0,
    success_count INTEGER DEFAULT 0,
    error_count INTEGER DEFAULT 0,
    
    -- æ—¶é—´æˆ³
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    
    CONSTRAINT unique_user_source_name UNIQUE (user_id, name)
);
```

#### 3. Source Metadata ç»“æ„å®šä¹‰
```typescript
// ä¸åŒæ¥æºçš„å…ƒæ•°æ®ç»“æ„
interface SourceMetadata {
  // Nextcloud æ–‡ä»¶
  nextcloud?: {
    file_id: string;
    path: string;
    size: number;
    mime_type: string;
    etag: string;
    last_modified: string;
    shared: boolean;
    device_info?: string;
  };
  
  // WebUI ä¸Šä¼ 
  webui?: {
    upload_ip: string;
    upload_user_agent: string;
    original_filename: string;
    file_size: number;
    upload_session_id: string;
  };
  
  // ç½‘é¡µçˆ¬å–
  web_crawl?: {
    url: string;
    domain: string;
    title: string;
    description?: string;
    author?: string;
    publish_date?: string;
    crawl_time: string;
    status_code: number;
    content_length: number;
    language?: string;
    keywords?: string[];
    images?: string[];
    links?: string[];
    crawl_depth: number;
    parent_url?: string;
  };
  
  // é‚®ä»¶å¯¼å…¥
  email?: {
    message_id: string;
    sender: string;
    recipients: string[];
    subject: string;
    date: string;
    thread_id?: string;
    labels?: string[];
    attachments?: Array<{
      filename: string;
      content_type: string;
      size: number;
    }>;
    mailbox: string; // Gmail, Outlook, etc.
  };
  
  // åº”ç”¨åŒæ­¥
  app_sync?: {
    app_name: string; // "å¾®ä¿¡", "é’‰é’‰", "Notion", etc.
    app_version: string;
    sync_method: string; // "api", "export", "webhook"
    item_id: string; // åº”ç”¨å†…çš„å”¯ä¸€æ ‡è¯†
    item_type: string; // "note", "document", "chat", etc.
    parent_id?: string;
    tags?: string[];
    created_by?: string;
    modified_by?: string;
  };
  
  // æ•°æ®åº“è¿æ¥
  database?: {
    db_type: string; // "mysql", "postgresql", "mongodb"
    table_name: string;
    primary_key: string;
    query: string;
    row_count: number;
    schema_info: object;
  };
  
  // RSS è®¢é˜…
  rss?: {
    feed_url: string;
    feed_title: string;
    item_guid: string;
    pub_date: string;
    author?: string;
    categories?: string[];
    enclosures?: Array<{
      url: string;
      type: string;
      length: number;
    }>;
  };
  
  // è‡ªåŠ¨åŒ–å·¥å…·
  automation?: {
    tool_name: string; // "Zapier", "IFTTT", "n8n"
    workflow_id: string;
    trigger_type: string;
    execution_id: string;
    trigger_data: object;
  };
  
  // Web æœç´¢ (å®æ—¶æœç´¢ç»“æœ)
  web_search?: {
    query: string;
    search_engine: string; // "google", "bing", "duckduckgo"
    search_time: string;
    result_rank: number;
    snippet: string;
    related_queries?: string[];
    search_context?: string; // ç”¨æˆ·æœç´¢çš„ä¸Šä¸‹æ–‡
    session_id?: string;
  };
  
  // MCP å·¥å…·è°ƒç”¨
  mcp_tool?: {
    tool_name: string;
    tool_version: string;
    call_parameters: object;
    execution_time: string;
    execution_duration_ms: number;
    result_type: string; // "success", "error", "partial"
    tool_category: string; // "search", "analysis", "generation", "action"
    user_intent?: string;
  };
  
  // è¯­éŸ³å¤‡å¿˜å½•
  voice_memo?: {
    duration_seconds: number;
    audio_format: string; // "mp3", "wav", "m4a"
    transcription_confidence: number;
    language_detected: string;
    speaker_id?: string;
    recording_device?: string;
    background_noise_level?: string;
    transcription_service: string; // "whisper", "google", "azure"
  };
  
  // SMS æ¶ˆæ¯
  sms?: {
    phone_number: string;
    sender_name?: string;
    message_thread_id?: string;
    timestamp: string;
    message_type: string; // "received", "sent"
    delivery_status?: string;
    carrier?: string;
  };
}
```

#### 4. Crawl Config ç»“æ„å®šä¹‰
```typescript
interface CrawlConfig {
  // åŸºç¡€çˆ¬å–é…ç½®
  enabled: boolean;
  frequency_hours: number; // çˆ¬å–é¢‘ç‡
  max_depth: number; // æœ€å¤§çˆ¬å–æ·±åº¦
  follow_links: boolean; // æ˜¯å¦è·Ÿéšé“¾æ¥
  
  // å†…å®¹è¿‡æ»¤
  content_selectors?: string[]; // CSS é€‰æ‹©å™¨
  exclude_selectors?: string[]; // æ’é™¤çš„é€‰æ‹©å™¨
  min_content_length?: number;
  max_content_length?: number;
  
  // è¯·æ±‚é…ç½®
  headers?: Record<string, string>;
  cookies?: Record<string, string>;
  user_agent?: string;
  timeout_seconds?: number;
  retry_count?: number;
  
  // åçˆ¬è™«é…ç½®
  delay_seconds?: number; // è¯·æ±‚é—´éš”
  use_proxy?: boolean;
  proxy_config?: {
    host: string;
    port: number;
    username?: string;
    password?: string;
  };
  
  // å†…å®¹å¤„ç†
  extract_images?: boolean;
  extract_links?: boolean;
  convert_relative_urls?: boolean;
  clean_html?: boolean;
  
  // é€šçŸ¥é…ç½®
  notify_on_change?: boolean;
  notify_on_error?: boolean;
  webhook_url?: string;
}
```

### æ•°æ®æºè¿æ¥é…ç½®

#### ç½‘é¡µçˆ¬å–æ•°æ®æº
```typescript
interface WebCrawlDataSource {
  type: 'web_crawl';
  name: string;
  config: {
    urls: string[]; // è¦çˆ¬å–çš„ URL åˆ—è¡¨
    crawl_config: CrawlConfig;
    
    // å†…å®¹è¯†åˆ«
    title_selector?: string;
    content_selector?: string;
    author_selector?: string;
    date_selector?: string;
    
    // åˆ†ç±»è§„åˆ™
    auto_categorize: boolean;
    category_keywords?: Record<string, string[]>;
    
    // å»é‡é…ç½®
    deduplication: {
      enabled: boolean;
      method: 'url' | 'content_hash' | 'title_similarity';
      similarity_threshold?: number;
    };
  };
}
```

#### é‚®ä»¶æ•°æ®æº
```typescript
interface EmailDataSource {
  type: 'email';
  name: string;
  config: {
    provider: 'gmail' | 'outlook' | 'imap';
    
    // è®¤è¯é…ç½®
    auth: {
      type: 'oauth2' | 'app_password' | 'imap';
      client_id?: string;
      client_secret?: string; // åŠ å¯†å­˜å‚¨
      refresh_token?: string; // åŠ å¯†å­˜å‚¨
      username?: string;
      password?: string; // åŠ å¯†å­˜å‚¨
      imap_server?: string;
      imap_port?: number;
    };
    
    // åŒæ­¥é…ç½®
    sync_folders: string[]; // ['INBOX', 'Sent', 'Important']
    sync_since_days: number;
    include_attachments: boolean;
    max_attachment_size_mb: number;
    
    // è¿‡æ»¤è§„åˆ™
    filters: {
      sender_whitelist?: string[];
      sender_blacklist?: string[];
      subject_keywords?: string[];
      has_attachments?: boolean;
      min_body_length?: number;
    };
    
    // å¤„ç†è§„åˆ™
    processing: {
      extract_links: boolean;
      extract_attachments: boolean;
      auto_categorize: boolean;
      merge_thread: boolean; // æ˜¯å¦åˆå¹¶é‚®ä»¶çº¿ç¨‹
    };
  };
}
```

#### åº”ç”¨åŒæ­¥æ•°æ®æº
```typescript
interface AppSyncDataSource {
  type: 'app_sync';
  name: string;
  config: {
    app_type: 'notion' | 'obsidian' | 'logseq' | 'wechat' | 'dingtalk' | 'slack';
    
    // API é…ç½®
    api_config: {
      base_url?: string;
      api_key?: string; // åŠ å¯†å­˜å‚¨
      access_token?: string; // åŠ å¯†å­˜å‚¨
      webhook_secret?: string; // åŠ å¯†å­˜å‚¨
    };
    
    // åŒæ­¥èŒƒå›´
    sync_scope: {
      workspaces?: string[];
      databases?: string[];
      pages?: string[];
      channels?: string[];
      date_range?: {
        start: string;
        end?: string;
      };
    };
    
    // å†…å®¹æ˜ å°„
    content_mapping: {
      title_field: string;
      content_field: string;
      tags_field?: string;
      author_field?: string;
      date_field?: string;
    };
    
    // åŒæ­¥ç­–ç•¥
    sync_strategy: {
      mode: 'full' | 'incremental';
      conflict_resolution: 'source_wins' | 'target_wins' | 'merge' | 'manual';
      preserve_formatting: boolean;
    };
  };
}
```

## ğŸ“Š ç»Ÿä¸€æ–‡ä»¶è§†å›¾è®¾è®¡

### æ‰©å±•çš„æ–‡ä»¶åˆ—è¡¨ç•Œé¢
```typescript
interface UnifiedFileView {
  // åŸºç¡€ä¿¡æ¯
  id: string;
  title: string;
  content: string;
  modality: 'text' | 'image' | 'pdf';
  
  // æ¥æºæ ‡è¯†
  source: {
    type: 'nextcloud' | 'webui' | 'web_crawl' | 'email' | 'app_sync' | 'database' | 'rss' | 'api';
    icon: React.ComponentType;
    label: string;
    color: string;
    subType?: string; // å­ç±»å‹ï¼Œå¦‚å…·ä½“çš„åº”ç”¨åç§°
  };
  
  // åŒæ­¥çŠ¶æ€
  syncStatus: {
    status: 'synced' | 'pending' | 'error';
    lastSync: Date;
    deviceInfo?: string; // æ¥è‡ªå“ªä¸ªè®¾å¤‡
  };
  
  // æ™ºèƒ½å…ƒæ•°æ®
  aiMetadata: {
    categories: Category[];
    tags: string[];
    confidence: number;
    processingStatus: 'completed' | 'processing' | 'failed';
  };
  
  // ç”¨æˆ·æ“ä½œ
  userActions: {
    canEdit: boolean;
    canDelete: boolean;
    canShare: boolean;
    canDownload: boolean;
  };
}
```

### ç•Œé¢å±•ç¤ºæ•ˆæœ
```jsx
const UnifiedFileList = () => {
  return (
    <div className="file-grid">
      {files.map(file => (
        <FileCard key={file.id}>
          {/* æ–‡ä»¶é¢„è§ˆ */}
          <FilePreview file={file} />
          
          {/* æ¥æºæ ‡è¯† */}
          <SourceBadge 
            type={file.source.type}
            icon={file.source.icon}
            color={file.source.color}
          />
          
          {/* åŒæ­¥çŠ¶æ€ */}
          <SyncStatus 
            status={file.syncStatus.status}
            lastSync={file.syncStatus.lastSync}
            device={file.syncStatus.deviceInfo}
          />
          
          {/* AI åˆ†æç»“æœ */}
          <AIInsights 
            categories={file.aiMetadata.categories}
            tags={file.aiMetadata.tags}
            confidence={file.aiMetadata.confidence}
          />
          
          {/* æ“ä½œæŒ‰é’® */}
          <FileActions actions={file.userActions} />
        </FileCard>
      ))}
    </div>
  );
};
```

## ğŸ” åˆ†å±‚ç”¨æˆ·ä½“ç³»è®¾è®¡

### æ ¸å¿ƒåŸåˆ™

**PKB ç‹¬ç«‹è´¦å·ç³»ç»Ÿ + å¤šæºæ•°æ®é›†æˆ**

- PKB æ‹¥æœ‰ç‹¬ç«‹çš„ç”¨æˆ·è®¤è¯ç³»ç»Ÿï¼Œä¸ä¾èµ–ä»»ä½•ç¬¬ä¸‰æ–¹æœåŠ¡
- Nextcloud ç­‰å¤–éƒ¨æœåŠ¡ä½œä¸ºå¯é€‰çš„æ•°æ®æºé›†æˆ
- ç”¨æˆ·å¯ä»¥é€‰æ‹©æœ€é€‚åˆè‡ªå·±çš„æ•°æ®æ¥æºç»„åˆ

### ç”¨æˆ·è®¤è¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PKB åŸç”Ÿè®¤è¯ç³»ç»Ÿ                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ğŸ” ä¸»è®¤è¯æ–¹å¼                                                  â”‚
â”‚  â”œâ”€â”€ ğŸ“§ é‚®ç®±å¯†ç æ³¨å†Œ/ç™»å½•                                       â”‚
â”‚  â”œâ”€â”€ ğŸ”— OAuth ç¬¬ä¸‰æ–¹ç™»å½•                                       â”‚
â”‚  â”‚   â”œâ”€â”€ Google OAuth                                         â”‚
â”‚  â”‚   â”œâ”€â”€ GitHub OAuth                                         â”‚
â”‚  â”‚   â””â”€â”€ å¾®ä¿¡æ‰«ç ç™»å½•                                          â”‚
â”‚  â””â”€â”€ ğŸ« JWT Token ç®¡ç†                                         â”‚
â”‚                                                                 â”‚
â”‚  âš™ï¸ å¯é€‰æ•°æ®æºé›†æˆ                                              â”‚
â”‚  â”œâ”€â”€ â˜ï¸ Nextcloud ç»‘å®š (æ–‡ä»¶åŒæ­¥)                              â”‚
â”‚  â”œâ”€â”€ ğŸ“ Google Drive é›†æˆ                                      â”‚
â”‚  â”œâ”€â”€ ğŸ“¦ Dropbox è¿æ¥                                           â”‚
â”‚  â”œâ”€â”€ ğŸ—‚ï¸ OneDrive åŒæ­¥                                          â”‚
â”‚  â””â”€â”€ ğŸ”Œ å…¶ä»– API é›†æˆ                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç”¨æˆ·æ•°æ®æ¨¡å‹

```sql
-- PKB ç”¨æˆ·è¡¨ (ä¸»è¡¨)
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email VARCHAR(255) UNIQUE NOT NULL,
    username VARCHAR(100),
    display_name VARCHAR(200),
    avatar_url TEXT,
    
    -- è®¤è¯ä¿¡æ¯
    password_hash VARCHAR(255), -- é‚®ç®±æ³¨å†Œç”¨æˆ·
    auth_provider VARCHAR(50),  -- 'email', 'google', 'github', 'wechat'
    provider_id VARCHAR(255),   -- ç¬¬ä¸‰æ–¹ç™»å½•çš„ç”¨æˆ·ID
    
    -- ç”¨æˆ·çŠ¶æ€
    is_active BOOLEAN DEFAULT true,
    is_verified BOOLEAN DEFAULT false,
    
    -- æ—¶é—´æˆ³
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    last_login_at TIMESTAMP WITH TIME ZONE,
    
    CONSTRAINT unique_provider_id UNIQUE (auth_provider, provider_id)
);

-- æ•°æ®æºé›†æˆè¡¨
CREATE TABLE user_integrations (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    
    -- é›†æˆç±»å‹
    integration_type VARCHAR(50) NOT NULL, -- 'nextcloud', 'google_drive', 'dropbox'
    integration_name VARCHAR(200), -- ç”¨æˆ·è‡ªå®šä¹‰åç§°
    
    -- è¿æ¥é…ç½®
    config JSONB NOT NULL DEFAULT '{}',
    credentials JSONB DEFAULT '{}', -- åŠ å¯†å­˜å‚¨
    
    -- çŠ¶æ€
    is_active BOOLEAN DEFAULT true,
    last_sync_at TIMESTAMP WITH TIME ZONE,
    sync_status VARCHAR(20) DEFAULT 'pending',
    
    -- æ—¶é—´æˆ³
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    
    CONSTRAINT unique_user_integration UNIQUE (user_id, integration_type, integration_name)
);
```

### è®¤è¯æœåŠ¡å®ç°

```python
class PKBAuthService:
    """PKB åŸç”Ÿè®¤è¯æœåŠ¡"""
    
    def __init__(self):
        self.db = PKBDatabase()
        self.jwt_service = JWTService()
        self.oauth_providers = {
            'google': GoogleOAuthProvider(),
            'github': GitHubOAuthProvider(),
            'wechat': WeChatOAuthProvider()
        }
    
    async def register_with_email(self, email: str, password: str, display_name: str = None):
        """é‚®ç®±æ³¨å†Œ"""
        # æ£€æŸ¥é‚®ç®±æ˜¯å¦å·²å­˜åœ¨
        existing_user = await self.db.get_user_by_email(email)
        if existing_user:
            raise UserExistsError("é‚®ç®±å·²è¢«æ³¨å†Œ")
        
        # åˆ›å»ºç”¨æˆ·
        user = await self.db.create_user({
            "email": email,
            "password_hash": self.hash_password(password),
            "display_name": display_name or email.split('@')[0],
            "auth_provider": "email",
            "is_verified": False
        })
        
        # å‘é€éªŒè¯é‚®ä»¶
        await self.send_verification_email(user)
        
        return user
    
    async def login_with_email(self, email: str, password: str):
        """é‚®ç®±ç™»å½•"""
        user = await self.db.get_user_by_email(email)
        if not user or not self.verify_password(password, user.password_hash):
            raise AuthenticationError("é‚®ç®±æˆ–å¯†ç é”™è¯¯")
        
        if not user.is_active:
            raise AuthenticationError("è´¦å·å·²è¢«ç¦ç”¨")
        
        # æ›´æ–°ç™»å½•æ—¶é—´
        await self.db.update_user(user.id, {"last_login_at": datetime.now()})
        
        # ç”Ÿæˆ JWT Token
        token = await self.jwt_service.generate_token(user)
        
        return {
            "user": user,
            "token": token,
            "integrations": await self.get_user_integrations(user.id)
        }
    
    async def oauth_login(self, provider: str, code: str):
        """ç¬¬ä¸‰æ–¹ OAuth ç™»å½•"""
        if provider not in self.oauth_providers:
            raise ValueError(f"ä¸æ”¯æŒçš„ç™»å½•æ–¹å¼: {provider}")
        
        oauth_provider = self.oauth_providers[provider]
        
        # è·å–ç¬¬ä¸‰æ–¹ç”¨æˆ·ä¿¡æ¯
        oauth_user = await oauth_provider.get_user_info(code)
        
        # æŸ¥æ‰¾æˆ–åˆ›å»ºç”¨æˆ·
        user = await self.db.get_user_by_provider(provider, oauth_user.id)
        
        if not user:
            # åˆ›å»ºæ–°ç”¨æˆ·
            user = await self.db.create_user({
                "email": oauth_user.email,
                "display_name": oauth_user.name,
                "avatar_url": oauth_user.avatar,
                "auth_provider": provider,
                "provider_id": oauth_user.id,
                "is_verified": True  # ç¬¬ä¸‰æ–¹ç™»å½•é»˜è®¤å·²éªŒè¯
            })
        else:
            # æ›´æ–°ç”¨æˆ·ä¿¡æ¯
            await self.db.update_user(user.id, {
                "display_name": oauth_user.name,
                "avatar_url": oauth_user.avatar,
                "last_login_at": datetime.now()
            })
        
        # ç”Ÿæˆ JWT Token
        token = await self.jwt_service.generate_token(user)
        
        return {
            "user": user,
            "token": token,
            "integrations": await self.get_user_integrations(user.id)
        }
```

### æ•°æ®æºé›†æˆç®¡ç†

```python
class IntegrationService:
    """æ•°æ®æºé›†æˆç®¡ç†æœåŠ¡"""
    
    async def add_nextcloud_integration(self, user_id: str, config: dict):
        """æ·»åŠ  Nextcloud é›†æˆ"""
        # æµ‹è¯•è¿æ¥
        nc_client = NextcloudClient(config)
        if not await nc_client.test_connection():
            raise ConnectionError("Nextcloud è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥é…ç½®")
        
        # åˆ›å»ºé›†æˆè®°å½•
        integration = await self.db.create_integration({
            "user_id": user_id,
            "integration_type": "nextcloud",
            "integration_name": config.get("name", "æˆ‘çš„ Nextcloud"),
            "config": {
                "webdav_url": config["webdav_url"],
                "username": config["username"],
                "sync_folders": config.get("sync_folders", ["PKB-Inbox"]),
                "file_extensions": config.get("file_extensions", [".txt", ".md", ".pdf"])
            },
            "credentials": self.encrypt_credentials({
                "password": config["password"]
            }),
            "is_active": True
        })
        
        # å¯åŠ¨é¦–æ¬¡åŒæ­¥
        await self.schedule_sync(integration.id)
        
        return integration
    
    async def get_user_integrations(self, user_id: str):
        """è·å–ç”¨æˆ·çš„æ‰€æœ‰é›†æˆ"""
        integrations = await self.db.get_user_integrations(user_id)
        
        # ä¸è¿”å›æ•æ„Ÿä¿¡æ¯
        return [
            {
                "id": integration.id,
                "type": integration.integration_type,
                "name": integration.integration_name,
                "is_active": integration.is_active,
                "last_sync": integration.last_sync_at,
                "sync_status": integration.sync_status
            }
            for integration in integrations
        ]

### ç”¨æˆ·å¼•å¯¼æµç¨‹è®¾è®¡

```typescript
interface UserOnboardingFlow {
  // ç¬¬ä¸€æ­¥ï¼šè´¦å·åˆ›å»º
  step1_registration: {
    options: [
      {
        type: "email";
        title: "é‚®ç®±æ³¨å†Œ";
        description: "ä½¿ç”¨é‚®ç®±åˆ›å»º PKB è´¦å·";
        recommended: true;
      },
      {
        type: "google";
        title: "Google ç™»å½•";
        description: "ä½¿ç”¨ Google è´¦å·å¿«é€Ÿç™»å½•";
        icon: "google";
      },
      {
        type: "github";
        title: "GitHub ç™»å½•";
        description: "ä½¿ç”¨ GitHub è´¦å·ç™»å½•";
        icon: "github";
      }
    ];
  };
  
  // ç¬¬äºŒæ­¥ï¼šé€‰æ‹©ä½¿ç”¨æ–¹å¼
  step2_usage_mode: {
    options: [
      {
        type: "quick_start";
        title: "ğŸš€ å¿«é€Ÿå¼€å§‹";
        description: "ç›´æ¥ä½¿ç”¨ WebUI ä¸Šä¼ æ–‡ä»¶ï¼Œç«‹å³ä½“éªŒ AI é—®ç­”";
        target_users: "è½»é‡ç”¨æˆ· (70%)";
        setup_time: "0 åˆ†é’Ÿ";
      },
      {
        type: "nextcloud_integration";
        title: "ğŸ”„ é›†æˆ Nextcloud";
        description: "è¿æ¥ç°æœ‰ Nextcloudï¼Œå®ç°å¤šè®¾å¤‡æ–‡ä»¶åŒæ­¥";
        target_users: "è¿›é˜¶ç”¨æˆ· (25%)";
        setup_time: "5 åˆ†é’Ÿ";
      },
      {
        type: "enterprise_setup";
        title: "ğŸ¢ ä¼ä¸šéƒ¨ç½²";
        description: "å›¢é˜Ÿåä½œå’Œé«˜çº§é›†æˆåŠŸèƒ½";
        target_users: "ä¼ä¸šç”¨æˆ· (5%)";
        setup_time: "30 åˆ†é’Ÿ";
      }
    ];
  };
  
  // ç¬¬ä¸‰æ­¥ï¼šé¦–æ¬¡ä½“éªŒ
  step3_first_experience: {
    quick_start: [
      "ä¸Šä¼ ç¬¬ä¸€ä¸ªæ–‡ä»¶ (æ‹–æ‹½æˆ–ç‚¹å‡»)",
      "ç­‰å¾… AI è‡ªåŠ¨åˆ†æå’Œåˆ†ç±»",
      "å°è¯•é—®ä¸€ä¸ªå…³äºæ–‡ä»¶å†…å®¹çš„é—®é¢˜",
      "ä½“éªŒæ™ºèƒ½æœç´¢åŠŸèƒ½"
    ];
    
    nextcloud_integration: [
      "é…ç½® Nextcloud è¿æ¥",
      "é€‰æ‹©åŒæ­¥æ–‡ä»¶å¤¹",
      "ç­‰å¾…é¦–æ¬¡åŒæ­¥å®Œæˆ",
      "ä½“éªŒè·¨è®¾å¤‡æ–‡ä»¶è®¿é—®"
    ];
  };
}
```

### ç•Œé¢è®¾è®¡è§„èŒƒ

```typescript
// ç™»å½•/æ³¨å†Œç•Œé¢
interface AuthInterface {
  layout: "center_card";
  
  registration_form: {
    fields: ["email", "password", "display_name"];
    validation: "real_time";
    submit_button: "åˆ›å»º PKB è´¦å·";
  };
  
  oauth_buttons: [
    {
      provider: "google";
      style: "outline";
      text: "ä½¿ç”¨ Google ç™»å½•";
    },
    {
      provider: "github";
      style: "outline";
      text: "ä½¿ç”¨ GitHub ç™»å½•";
    }
  ];
  
  mode_selection: {
    title: "é€‰æ‹©æ‚¨çš„ä½¿ç”¨æ–¹å¼";
    cards: [
      {
        id: "quick_start";
        icon: "rocket";
        title: "å¿«é€Ÿå¼€å§‹";
        description: "ç«‹å³ä½“éªŒ AI æ™ºèƒ½é—®ç­”";
        action: "ç›´æ¥è¿›å…¥ä¸»ç•Œé¢";
      },
      {
        id: "setup_integrations";
        icon: "settings";
        title: "é…ç½®æ•°æ®æº";
        description: "è¿æ¥ Nextcloud ç­‰å¤–éƒ¨æœåŠ¡";
        action: "è¿›å…¥è®¾ç½®å‘å¯¼";
      }
    ];
  };
}

// æ•°æ®æºç®¡ç†ç•Œé¢
interface IntegrationInterface {
  layout: "settings_page";
  
  integration_list: {
    title: "æ•°æ®æºç®¡ç†";
    description: "è¿æ¥å¤–éƒ¨æœåŠ¡ï¼Œè‡ªåŠ¨åŒæ­¥æ‚¨çš„æ–‡ä»¶";
    
    items: [
      {
        type: "webui";
        name: "WebUI ä¸Šä¼ ";
        status: "active";
        description: "ç›´æ¥åœ¨ç½‘é¡µä¸Šä¼ æ–‡ä»¶";
        actions: ["æŸ¥çœ‹ç»Ÿè®¡"];
        removable: false;
      },
      {
        type: "nextcloud";
        name: "Nextcloud åŒæ­¥";
        status: "disconnected";
        description: "è¿æ¥æ‚¨çš„ Nextcloud æœåŠ¡å™¨";
        actions: ["è¿æ¥", "é…ç½®"];
        setup_required: true;
      },
      {
        type: "google_drive";
        name: "Google Drive";
        status: "coming_soon";
        description: "å³å°†æ”¯æŒ Google Drive é›†æˆ";
        actions: [];
        disabled: true;
      }
    ];
  };
  
  setup_wizard: {
    nextcloud: {
      steps: [
        {
          title: "æœåŠ¡å™¨ä¿¡æ¯";
          fields: ["server_url", "username", "password"];
        },
        {
          title: "åŒæ­¥è®¾ç½®";
          fields: ["sync_folders", "file_types", "sync_frequency"];
        },
        {
          title: "æµ‹è¯•è¿æ¥";
          action: "validate_and_save";
        }
      ];
    };
  };
}
```

### ç”¨æˆ·éš”ç¦»æœºåˆ¶
```python
class UserIsolationService:
    """ç¡®ä¿ä¸åŒç”¨æˆ·çš„æ•°æ®å®Œå…¨éš”ç¦»"""
    
    async def get_user_files(self, user_id: str, source_filter: str = None):
        """è·å–ç”¨æˆ·çš„æ‰€æœ‰æ–‡ä»¶ï¼Œæ”¯æŒæ¥æºè¿‡æ»¤"""
        query = self.db.query(Content).filter(Content.user_id == user_id)
        
        if source_filter:
            query = query.filter(Content.source_type == source_filter)
        
        return query.all()
    
    async def search_user_knowledge(self, user_id: str, query: str):
        """åœ¨ç”¨æˆ·çš„çŸ¥è¯†åº“ä¸­æœç´¢"""
        # å‘é‡æœç´¢ä¹Ÿè¦åŠ ä¸Šç”¨æˆ·è¿‡æ»¤
        results = await self.vector_search(
            query=query,
            filter={"user_id": user_id}
        )
        return results
    
    async def qa_with_user_context(self, user_id: str, question: str):
        """åŸºäºç”¨æˆ·ä¸ªäººçŸ¥è¯†åº“çš„é—®ç­”"""
        user_context = await self.get_user_knowledge_context(user_id)
        return await self.ai_service.answer_question(question, user_context)
```

## ğŸ” ç»Ÿä¸€æœç´¢ä½“éªŒ

### è·¨æ¥æºæœç´¢
```python
class UnifiedSearchService:
    async def search(self, user_id: str, query: str, filters: dict = None):
        """ç»Ÿä¸€æœç´¢ï¼šè·¨æ‰€æœ‰æ¥æºï¼Œä½†ä¿ç•™æ¥æºä¿¡æ¯"""
        
        # 1. è¯­ä¹‰æœç´¢ï¼ˆè·¨æ‰€æœ‰æ¥æºï¼‰
        semantic_results = await self.semantic_search(
            user_id=user_id,
            query=query,
            filters=filters
        )
        
        # 2. å…³é”®è¯æœç´¢ï¼ˆè¡¥å……ï¼‰
        keyword_results = await self.keyword_search(
            user_id=user_id,
            query=query,
            filters=filters
        )
        
        # 3. åˆå¹¶ç»“æœï¼Œä¿ç•™æ¥æºä¿¡æ¯
        unified_results = await self.merge_search_results(
            semantic_results, 
            keyword_results
        )
        
        # 4. æ·»åŠ æ¥æºå…ƒæ•°æ®
        for result in unified_results:
            result.source_metadata = await self.get_source_metadata(result)
        
        return unified_results
    
    async def get_source_metadata(self, content):
        """è·å–æ–‡ä»¶æ¥æºçš„è¯¦ç»†å…ƒæ•°æ®"""
        if content.source_type == 'nextcloud':
            return {
                "type": "nextcloud",
                "icon": "cloud",
                "label": "äº‘ç›˜æ–‡ä»¶",
                "color": "#0082c9",
                "sync_info": await self.get_nextcloud_sync_info(content),
                "share_info": await self.get_nextcloud_share_info(content)
            }
        elif content.source_type == 'webui':
            return {
                "type": "webui",
                "icon": "upload",
                "label": "ç›´æ¥ä¸Šä¼ ",
                "color": "#52c41a",
                "upload_info": await self.get_upload_info(content)
            }
        elif content.source_type == 'web_crawl':
            return {
                "type": "web_crawl",
                "icon": "global",
                "label": "ç½‘é¡µçˆ¬å–",
                "color": "#1890ff",
                "url_info": await self.get_url_info(content),
                "crawl_time": content.source_metadata.get("crawl_time")
            }
        elif content.source_type == 'email':
            return {
                "type": "email",
                "icon": "mail",
                "label": "é‚®ä»¶å¯¼å…¥",
                "color": "#fa8c16",
                "sender": content.source_metadata.get("sender"),
                "subject": content.source_metadata.get("subject")
            }
        elif content.source_type == 'app_sync':
            return {
                "type": "app_sync",
                "icon": "mobile",
                "label": f"{content.source_metadata.get('app_name', 'åº”ç”¨')}åŒæ­¥",
                "color": "#722ed1",
                "app_info": await self.get_app_sync_info(content)
            }
        elif content.source_type == 'database':
            return {
                "type": "database",
                "icon": "database",
                "label": "æ•°æ®åº“åŒæ­¥",
                "color": "#13c2c2",
                "db_info": await self.get_database_info(content)
            }
        elif content.source_type == 'rss':
            return {
                "type": "rss",
                "icon": "rss",
                "label": "RSSè®¢é˜…",
                "color": "#fa541c",
                "feed_info": await self.get_rss_info(content)
            }
```

## ğŸŒ Web Search vs Web Crawl ç»Ÿä¸€è®¾è®¡

### æ ¸å¿ƒåŒºåˆ«ä¸ç»Ÿä¸€ç­–ç•¥

æ ¹æ®ä½ çš„è®¾è®¡è“å›¾ï¼Œæˆ‘ä»¬éœ€è¦åŒºåˆ†ä¸¤ç§ä¸åŒçš„ Web æ•°æ®è·å–æ–¹å¼ï¼š

#### 1. Web Search (å®æ—¶æœç´¢)
```typescript
interface WebSearchService {
  // ç”¨é€”ï¼šå›ç­”ç”¨æˆ·å³æ—¶é—®é¢˜ï¼Œè·å–æœ€æ–°ä¿¡æ¯
  purpose: "real_time_qa" | "fact_checking" | "current_events";
  
  // ç‰¹ç‚¹ï¼š
  characteristics: {
    realTime: true;           // å®æ—¶æœç´¢
    temporary: true;          // ä¸´æ—¶ç»“æœï¼Œå¯é€‰æ‹©æ€§ä¿å­˜
    contextual: true;         // åŸºäºç”¨æˆ·å½“å‰å¯¹è¯ä¸Šä¸‹æ–‡
    ranked: true;             // æœç´¢å¼•æ“æ’åº
  };
  
  // è§¦å‘æ–¹å¼ï¼š
  triggers: [
    "ç”¨æˆ·é—®ç­”ä¸­éœ€è¦æœ€æ–°ä¿¡æ¯",
    "AI åŠ©æ‰‹ä¸»åŠ¨æœç´¢è¡¥å……ä¿¡æ¯", 
    "ç”¨æˆ·æ˜ç¡®è¦æ±‚æœç´¢",
    "çŸ¥è¯†åº“ä¸­ä¿¡æ¯ä¸è¶³æ—¶"
  ];
  
  // æ•°æ®å¤„ç†ï¼š
  processing: {
    immediate: true;          // ç«‹å³è¿”å›ç»™ç”¨æˆ·
    optional_save: true;      // ç”¨æˆ·å¯é€‰æ‹©ä¿å­˜åˆ°çŸ¥è¯†åº“
    ai_summary: true;         // AI æ€»ç»“æœç´¢ç»“æœ
    context_aware: true;      // ç»“åˆç”¨æˆ·ä¸Šä¸‹æ–‡ç†è§£
  };
}
```

#### 2. Web Crawl (å®šæœŸçˆ¬å–)
```typescript
interface WebCrawlService {
  // ç”¨é€”ï¼šæŒç»­ç›‘æ§ç‰¹å®šç½‘ç«™ï¼Œæ„å»ºçŸ¥è¯†åº“
  purpose: "knowledge_building" | "content_monitoring" | "data_collection";
  
  // ç‰¹ç‚¹ï¼š
  characteristics: {
    scheduled: true;          // å®šæ—¶æ‰§è¡Œ
    persistent: true;         // æ°¸ä¹…ä¿å­˜
    systematic: true;         // ç³»ç»Ÿæ€§çˆ¬å–
    comprehensive: true;      // å®Œæ•´å†…å®¹è·å–
  };
  
  // è§¦å‘æ–¹å¼ï¼š
  triggers: [
    "ç”¨æˆ·æ·»åŠ ç›‘æ§ç½‘ç«™",
    "å®šæ—¶ä»»åŠ¡è°ƒåº¦",
    "ç½‘ç«™å†…å®¹æ›´æ–°æ£€æµ‹",
    "ç”¨æˆ·æ‰‹åŠ¨è§¦å‘çˆ¬å–"
  ];
  
  // æ•°æ®å¤„ç†ï¼š
  processing: {
    full_content: true;       // è·å–å®Œæ•´å†…å®¹
    auto_save: true;          // è‡ªåŠ¨ä¿å­˜åˆ°çŸ¥è¯†åº“
    ai_analysis: true;        // AI åˆ†æå’Œåˆ†ç±»
    relationship_mining: true; // æŒ–æ˜å†…å®¹å…³ç³»
  };
}
```

### ç»Ÿä¸€æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Web æœåŠ¡ç»Ÿä¸€å…¥å£                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ğŸ” WebService (ç»Ÿä¸€è°ƒåº¦å™¨)                                     â”‚
â”‚  â”‚                                                             â”‚
â”‚  â”œâ”€â”€ ğŸ“Š æ„å›¾è¯†åˆ« (Search vs Crawl)                             â”‚
â”‚  â”œâ”€â”€ ğŸ¯ ä¸Šä¸‹æ–‡åˆ†æ (ç”¨æˆ·éœ€æ±‚ç†è§£)                               â”‚
â”‚  â”œâ”€â”€ ğŸš¦ æµé‡æ§åˆ¶ (é˜²æ­¢è¿‡åº¦è¯·æ±‚)                                â”‚
â”‚  â””â”€â”€ ğŸ“ˆ ç»“æœèšåˆ (å¤šæºç»“æœæ•´åˆ)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åŒè½¨æ‰§è¡Œå¼•æ“                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  âš¡ Real-time Search Engine    ğŸ“… Scheduled Crawl Engine       â”‚
â”‚  â”‚                            â”‚                                â”‚
â”‚  â”œâ”€â”€ ğŸ” Google/Bing API       â”œâ”€â”€ ğŸ•·ï¸ ç½‘é¡µçˆ¬è™«                  â”‚
â”‚  â”œâ”€â”€ ğŸ“Š ç»“æœæ’åºå’Œè¿‡æ»¤         â”œâ”€â”€ ğŸ“„ å†…å®¹è§£æ                  â”‚
â”‚  â”œâ”€â”€ ğŸ’¬ ä¸Šä¸‹æ–‡ç†è§£             â”œâ”€â”€ ğŸ”„ å¢é‡æ›´æ–°                  â”‚
â”‚  â”œâ”€â”€ ğŸ“ å³æ—¶æ‘˜è¦ç”Ÿæˆ           â”œâ”€â”€ ğŸ“š çŸ¥è¯†åº“æ„å»º                â”‚
â”‚  â””â”€â”€ ğŸ’¾ å¯é€‰ä¿å­˜               â””â”€â”€ ğŸ·ï¸ è‡ªåŠ¨åˆ†ç±»æ ‡è®°              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ› ï¸ MCP Tool ç½‘å…³è®¾è®¡

### MCP Tool åœ¨æ™ºèƒ½åŠ©ç†ä¸­çš„è§’è‰²

åŸºäºä½ çš„è®¾è®¡è“å›¾ï¼ŒMCP Tool ä½œä¸º **Agent Hub** å’Œ **Operator** ä¹‹é—´çš„æ¡¥æ¢ï¼š

```typescript
interface MCPToolGateway {
  // æ ¸å¿ƒåŠŸèƒ½
  functions: {
    tool_discovery: "å‘ç°å’Œæ³¨å†Œå¯ç”¨å·¥å…·";
    tool_orchestration: "åè°ƒå¤šä¸ªå·¥å…·åä½œ";
    result_integration: "æ•´åˆå·¥å…·æ‰§è¡Œç»“æœ";
    context_management: "ç®¡ç†å·¥å…·è°ƒç”¨ä¸Šä¸‹æ–‡";
  };
  
  // å·¥å…·åˆ†ç±»
  categories: {
    search_tools: ["web_search", "knowledge_search", "file_search"];
    analysis_tools: ["text_analysis", "image_analysis", "data_analysis"];
    generation_tools: ["content_generation", "image_generation", "code_generation"];
    action_tools: ["email_send", "calendar_create", "file_operation"];
    integration_tools: ["api_call", "database_query", "webhook_trigger"];
  };
  
  // è°ƒç”¨ç­–ç•¥
  strategies: {
    sequential: "æŒ‰é¡ºåºè°ƒç”¨å·¥å…·";
    parallel: "å¹¶è¡Œè°ƒç”¨å¤šä¸ªå·¥å…·";
    conditional: "åŸºäºæ¡ä»¶é€‰æ‹©å·¥å…·";
    iterative: "è¿­ä»£è°ƒç”¨ç›´åˆ°æ»¡è¶³æ¡ä»¶";
  };
}
```

### MCP Tool ä¸æ•°æ®æºçš„å…³ç³»

```python
class UnifiedMCPService:
    """ç»Ÿä¸€çš„ MCP å·¥å…·æœåŠ¡ï¼Œæ•´åˆæ•°æ®æºå’Œå·¥å…·è°ƒç”¨"""
    
    def __init__(self):
        self.data_sources = DataSourceManager()
        self.mcp_tools = MCPToolManager()
        self.web_service = WebService()
    
    async def handle_user_request(self, user_input: str, context: dict):
        """å¤„ç†ç”¨æˆ·è¯·æ±‚ï¼Œæ™ºèƒ½é€‰æ‹©å·¥å…·å’Œæ•°æ®æº"""
        
        # 1. æ„å›¾è¯†åˆ«
        intent = await self.analyze_intent(user_input, context)
        
        # 2. é€‰æ‹©æ‰§è¡Œç­–ç•¥
        if intent.type == "immediate_question":
            # å®æ—¶æœç´¢ + çŸ¥è¯†åº“æŸ¥è¯¢
            return await self.handle_immediate_question(intent)
            
        elif intent.type == "knowledge_building":
            # ç½‘é¡µçˆ¬å– + æ•°æ®æºåŒæ­¥
            return await self.handle_knowledge_building(intent)
            
        elif intent.type == "complex_task":
            # MCP å·¥å…·ç¼–æ’
            return await self.handle_complex_task(intent)
    
    async def handle_immediate_question(self, intent):
        """å¤„ç†å³æ—¶é—®é¢˜"""
        # å¹¶è¡Œæ‰§è¡Œï¼šçŸ¥è¯†åº“æœç´¢ + å®æ—¶ç½‘é¡µæœç´¢
        knowledge_results = await self.search_knowledge_base(intent.query)
        web_results = await self.web_service.real_time_search(intent.query)
        
        # ç»“æœèåˆå’Œæ’åº
        unified_results = await self.merge_results(knowledge_results, web_results)
        
        # ç”Ÿæˆå›ç­”
        answer = await self.generate_answer(unified_results, intent)
        
        # å¯é€‰ï¼šä¿å­˜æœ‰ä»·å€¼çš„æœç´¢ç»“æœåˆ°çŸ¥è¯†åº“
        if intent.should_save:
            await self.save_valuable_results(web_results)
        
        return answer
    
    async def handle_complex_task(self, intent):
        """å¤„ç†å¤æ‚ä»»åŠ¡ï¼Œéœ€è¦å¤šå·¥å…·åä½œ"""
        # ä»»åŠ¡åˆ†è§£
        subtasks = await self.decompose_task(intent)
        
        # å·¥å…·ç¼–æ’
        execution_plan = await self.create_execution_plan(subtasks)
        
        # æ‰§è¡Œå·¥å…·é“¾
        results = []
        for step in execution_plan:
            if step.type == "mcp_tool":
                result = await self.mcp_tools.call_tool(step.tool_name, step.parameters)
            elif step.type == "data_source":
                result = await self.data_sources.query_source(step.source_name, step.query)
            elif step.type == "web_search":
                result = await self.web_service.search(step.query)
            
            results.append(result)
            
            # åŠ¨æ€è°ƒæ•´åç»­æ­¥éª¤
            execution_plan = await self.adjust_plan(execution_plan, result)
        
        # æ•´åˆæœ€ç»ˆç»“æœ
        return await self.integrate_results(results)
```

## ğŸ”„ å¤šæºæ•°æ®å¤„ç†æœåŠ¡

### æ•°æ®æºç®¡ç†æœåŠ¡
```python
class DataSourceManager:
    """ç»Ÿä¸€çš„æ•°æ®æºç®¡ç†æœåŠ¡"""
    
    async def create_data_source(self, user_id: str, source_config: dict):
        """åˆ›å»ºæ–°çš„æ•°æ®æº"""
        # éªŒè¯é…ç½®
        validated_config = await self.validate_source_config(source_config)
        
        # æµ‹è¯•è¿æ¥
        connection_test = await self.test_connection(validated_config)
        if not connection_test.success:
            raise ValueError(f"è¿æ¥æµ‹è¯•å¤±è´¥: {connection_test.error}")
        
        # åˆ›å»ºæ•°æ®æºè®°å½•
        data_source = await self.db.create_data_source({
            "user_id": user_id,
            "name": source_config["name"],
            "source_type": source_config["type"],
            "connection_config": validated_config,
            "sync_enabled": True,
            "next_sync_at": datetime.now() + timedelta(hours=1)
        })
        
        # å¯åŠ¨é¦–æ¬¡åŒæ­¥
        await self.schedule_sync(data_source.id)
        
        return data_source
    
    async def sync_data_source(self, source_id: str):
        """åŒæ­¥æŒ‡å®šæ•°æ®æº"""
        source = await self.db.get_data_source(source_id)
        if not source or not source.is_active:
            return
        
        try:
            # æ ¹æ®æ•°æ®æºç±»å‹é€‰æ‹©åŒæ­¥å™¨
            syncer = self.get_syncer(source.source_type)
            
            # æ‰§è¡ŒåŒæ­¥
            sync_result = await syncer.sync(source)
            
            # æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            await self.update_sync_stats(source_id, sync_result)
            
            # è°ƒåº¦ä¸‹æ¬¡åŒæ­¥
            await self.schedule_next_sync(source_id)
            
        except Exception as e:
            await self.handle_sync_error(source_id, e)
    
    def get_syncer(self, source_type: str):
        """è·å–å¯¹åº”çš„åŒæ­¥å™¨"""
        syncers = {
            'web_crawl': WebCrawlSyncer(),
            'email': EmailSyncer(),
            'app_sync': AppSyncSyncer(),
            'database': DatabaseSyncer(),
            'rss': RSSyncer(),
        }
        return syncers.get(source_type)
```

### ç½‘é¡µçˆ¬å–æœåŠ¡
```python
class WebCrawlSyncer:
    """ç½‘é¡µçˆ¬å–åŒæ­¥å™¨"""
    
    async def sync(self, data_source):
        """æ‰§è¡Œç½‘é¡µçˆ¬å–åŒæ­¥"""
        config = data_source.connection_config
        results = []
        
        for url in config['urls']:
            try:
                # æ£€æŸ¥æ˜¯å¦éœ€è¦çˆ¬å– (åŸºäºé¢‘ç‡å’Œå˜æ›´æ£€æµ‹)
                if not await self.should_crawl(url, data_source):
                    continue
                
                # æ‰§è¡Œçˆ¬å–
                crawl_result = await self.crawl_url(url, config['crawl_config'])
                
                # å†…å®¹å»é‡æ£€æŸ¥
                if await self.is_duplicate_content(crawl_result, data_source.user_id):
                    continue
                
                # åˆ›å»ºæˆ–æ›´æ–°å†…å®¹è®°å½•
                content = await self.create_or_update_content(
                    user_id=data_source.user_id,
                    source_uri=url,
                    crawl_result=crawl_result,
                    data_source_id=data_source.id
                )
                
                results.append(content)
                
            except Exception as e:
                logger.error(f"çˆ¬å– {url} å¤±è´¥: {e}")
                continue
        
        return {
            "success_count": len(results),
            "total_urls": len(config['urls']),
            "new_contents": results
        }
    
    async def crawl_url(self, url: str, crawl_config: dict):
        """çˆ¬å–å•ä¸ª URL"""
        # è®¾ç½®è¯·æ±‚å¤´å’Œä»£ç†
        headers = crawl_config.get('headers', {})
        headers.setdefault('User-Agent', crawl_config.get('user_agent', 'PKB-Crawler/1.0'))
        
        # å‘é€è¯·æ±‚
        async with aiohttp.ClientSession(
            timeout=aiohttp.ClientTimeout(total=crawl_config.get('timeout_seconds', 30))
        ) as session:
            async with session.get(url, headers=headers) as response:
                if response.status != 200:
                    raise Exception(f"HTTP {response.status}: {response.reason}")
                
                html_content = await response.text()
                
                # è§£æå†…å®¹
                soup = BeautifulSoup(html_content, 'html.parser')
                
                # æå–æ ‡é¢˜
                title = self.extract_title(soup, crawl_config)
                
                # æå–æ­£æ–‡å†…å®¹
                content = self.extract_content(soup, crawl_config)
                
                # æå–å…ƒæ•°æ®
                metadata = self.extract_metadata(soup, url, response)
                
                return {
                    "title": title,
                    "content": content,
                    "metadata": metadata,
                    "raw_html": html_content if crawl_config.get('save_raw_html') else None
                }
```

### é‚®ä»¶åŒæ­¥æœåŠ¡
```python
class EmailSyncer:
    """é‚®ä»¶åŒæ­¥å™¨"""
    
    async def sync(self, data_source):
        """æ‰§è¡Œé‚®ä»¶åŒæ­¥"""
        config = data_source.connection_config
        
        # å»ºç«‹é‚®ä»¶è¿æ¥
        email_client = await self.create_email_client(config['auth'])
        
        results = []
        
        for folder in config['sync_folders']:
            try:
                # è·å–é‚®ä»¶åˆ—è¡¨
                messages = await email_client.get_messages(
                    folder=folder,
                    since_days=config['sync_since_days'],
                    filters=config.get('filters', {})
                )
                
                for message in messages:
                    # æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
                    existing = await self.find_existing_email(
                        message['message_id'], 
                        data_source.user_id
                    )
                    if existing:
                        continue
                    
                    # å¤„ç†é‚®ä»¶å†…å®¹
                    processed_message = await self.process_email_message(
                        message, 
                        config['processing']
                    )
                    
                    # åˆ›å»ºå†…å®¹è®°å½•
                    content = await self.create_email_content(
                        user_id=data_source.user_id,
                        message=processed_message,
                        data_source_id=data_source.id
                    )
                    
                    results.append(content)
                    
            except Exception as e:
                logger.error(f"åŒæ­¥é‚®ä»¶æ–‡ä»¶å¤¹ {folder} å¤±è´¥: {e}")
                continue
        
        return {
            "success_count": len(results),
            "folders_synced": len(config['sync_folders']),
            "new_emails": results
        }
    
    async def process_email_message(self, message: dict, processing_config: dict):
        """å¤„ç†é‚®ä»¶æ¶ˆæ¯"""
        processed = {
            "subject": message['subject'],
            "body": message['body'],
            "sender": message['sender'],
            "recipients": message['recipients'],
            "date": message['date'],
            "attachments": []
        }
        
        # æå–é™„ä»¶
        if processing_config.get('extract_attachments') and message.get('attachments'):
            for attachment in message['attachments']:
                if attachment['size'] <= processing_config.get('max_attachment_size_mb', 10) * 1024 * 1024:
                    processed['attachments'].append(attachment)
        
        # æå–é“¾æ¥
        if processing_config.get('extract_links'):
            processed['links'] = self.extract_links_from_email(message['body'])
        
        # åˆå¹¶é‚®ä»¶çº¿ç¨‹
        if processing_config.get('merge_thread'):
            thread_messages = await self.get_thread_messages(message['thread_id'])
            processed['thread_context'] = thread_messages
        
        return processed
```

### åº”ç”¨åŒæ­¥æœåŠ¡
```python
class AppSyncSyncer:
    """åº”ç”¨åŒæ­¥å™¨ (æ”¯æŒ Notionã€å¾®ä¿¡ç­‰)"""
    
    async def sync(self, data_source):
        """æ‰§è¡Œåº”ç”¨åŒæ­¥"""
        config = data_source.connection_config
        app_type = config['app_type']
        
        # è·å–å¯¹åº”çš„åº”ç”¨é€‚é…å™¨
        adapter = self.get_app_adapter(app_type)
        
        # å»ºç«‹è¿æ¥
        client = await adapter.create_client(config['api_config'])
        
        results = []
        
        # æ ¹æ®åŒæ­¥èŒƒå›´è·å–æ•°æ®
        for scope_item in self.get_sync_items(config['sync_scope']):
            try:
                # è·å–åº”ç”¨æ•°æ®
                app_data = await client.get_data(scope_item)
                
                # è½¬æ¢ä¸ºç»Ÿä¸€æ ¼å¼
                unified_data = await adapter.transform_data(
                    app_data, 
                    config['content_mapping']
                )
                
                # æ£€æŸ¥å†²çªå’Œå»é‡
                conflict_resolution = await self.handle_conflicts(
                    unified_data, 
                    data_source.user_id,
                    config['sync_strategy']['conflict_resolution']
                )
                
                # åˆ›å»ºæˆ–æ›´æ–°å†…å®¹
                content = await self.create_or_update_app_content(
                    user_id=data_source.user_id,
                    app_data=unified_data,
                    data_source_id=data_source.id,
                    resolution=conflict_resolution
                )
                
                results.append(content)
                
            except Exception as e:
                logger.error(f"åŒæ­¥åº”ç”¨æ•°æ® {scope_item} å¤±è´¥: {e}")
                continue
        
        return {
            "success_count": len(results),
            "app_type": app_type,
            "synced_items": results
        }
    
    def get_app_adapter(self, app_type: str):
        """è·å–åº”ç”¨é€‚é…å™¨"""
        adapters = {
            'notion': NotionAdapter(),
            'obsidian': ObsidianAdapter(),
            'wechat': WeChatAdapter(),
            'dingtalk': DingTalkAdapter(),
            'slack': SlackAdapter(),
        }
        return adapters.get(app_type)
```

### ç»Ÿä¸€å†…å®¹å¤„ç†æµæ°´çº¿
```python
class ContentProcessingPipeline:
    """ç»Ÿä¸€çš„å†…å®¹å¤„ç†æµæ°´çº¿"""
    
    async def process_content(self, content_id: str):
        """å¤„ç†æ–°åˆ›å»ºçš„å†…å®¹"""
        content = await self.db.get_content(content_id)
        if not content:
            return
        
        try:
            # 1. å†…å®¹æ¸…æ´—å’Œæ ‡å‡†åŒ–
            cleaned_content = await self.clean_content(content)
            
            # 2. è¯­è¨€æ£€æµ‹
            language = await self.detect_language(cleaned_content.content)
            
            # 3. å†…å®¹åˆ†æå’Œæå–
            analysis = await self.analyze_content(cleaned_content, language)
            
            # 4. AI åˆ†ç±»
            categories = await self.classify_content(cleaned_content, analysis)
            
            # 5. æ ‡ç­¾æå–
            tags = await self.extract_tags(cleaned_content, analysis)
            
            # 6. å‘é‡åŒ–
            embeddings = await self.generate_embeddings(cleaned_content.content)
            
            # 7. å…³ç³»æŒ–æ˜
            relationships = await self.find_relationships(content_id, embeddings)
            
            # 8. æ›´æ–°å†…å®¹è®°å½•
            await self.update_content_analysis(content_id, {
                "language": language,
                "analysis": analysis,
                "categories": categories,
                "tags": tags,
                "relationships": relationships,
                "processing_status": "completed"
            })
            
            # 9. è§¦å‘åç»­å¤„ç†
            await self.trigger_post_processing(content_id)
            
        except Exception as e:
            logger.error(f"å¤„ç†å†…å®¹ {content_id} å¤±è´¥: {e}")
            await self.mark_processing_failed(content_id, str(e))
    
    async def clean_content(self, content):
        """å†…å®¹æ¸…æ´—"""
        if content.source_type == 'web_crawl':
            # æ¸…ç† HTML æ ‡ç­¾å’Œæ— ç”¨å†…å®¹
            return self.clean_html_content(content)
        elif content.source_type == 'email':
            # æ¸…ç†é‚®ä»¶æ ¼å¼å’Œç­¾å
            return self.clean_email_content(content)
        else:
            return content
```

## ğŸ“± å¤šè®¾å¤‡ä¸€è‡´æ€§ä¿è¯

### çŠ¶æ€åŒæ­¥æœºåˆ¶
```python
class CrossDeviceSync:
    async def sync_user_state(self, user_id: str, device_id: str):
        """åŒæ­¥ç”¨æˆ·åœ¨ä¸åŒè®¾å¤‡é—´çš„çŠ¶æ€"""
        
        # 1. åŒæ­¥ç”¨æˆ·åå¥½è®¾ç½®
        preferences = await self.get_user_preferences(user_id)
        await self.cache_user_preferences(device_id, preferences)
        
        # 2. åŒæ­¥æœç´¢å†å²
        search_history = await self.get_search_history(user_id, limit=100)
        await self.cache_search_history(device_id, search_history)
        
        # 3. åŒæ­¥æ”¶è—å’Œæ ‡ç­¾
        bookmarks = await self.get_user_bookmarks(user_id)
        custom_tags = await self.get_user_custom_tags(user_id)
        
        return {
            "preferences": preferences,
            "search_history": search_history,
            "bookmarks": bookmarks,
            "custom_tags": custom_tags,
            "sync_timestamp": datetime.now()
        }
```

## âš ï¸ æ–¹æ¡ˆæ½œåœ¨ç¼ºé™·åˆ†æ

### 1. **æŠ€æœ¯å¤æ‚åº¦å¢åŠ **
```
ç¼ºé™·ï¼šéœ€è¦ç»´æŠ¤å¤šä¸ªç³»ç»Ÿçš„é›†æˆ
å½±å“ï¼šå¼€å‘å’Œç»´æŠ¤æˆæœ¬å¢åŠ 
ç¼“è§£ï¼š
â”œâ”€â”€ ä½¿ç”¨æˆç†Ÿçš„é›†æˆæ¡†æ¶
â”œâ”€â”€ å®Œå–„çš„é”™è¯¯å¤„ç†å’Œç›‘æ§
â””â”€â”€ è‡ªåŠ¨åŒ–æµ‹è¯•è¦†ç›–é›†æˆç‚¹
```

### 2. **æ•°æ®ä¸€è‡´æ€§æŒ‘æˆ˜**
```
ç¼ºé™·ï¼šNextcloud å’Œ PKB æ•°æ®å¯èƒ½ä¸åŒæ­¥
å½±å“ï¼šç”¨æˆ·çœ‹åˆ°è¿‡æœŸæˆ–é”™è¯¯ä¿¡æ¯
ç¼“è§£ï¼š
â”œâ”€â”€ å®æ—¶åŒæ­¥æœºåˆ¶ + å¢é‡æ›´æ–°
â”œâ”€â”€ å†²çªæ£€æµ‹å’Œè‡ªåŠ¨è§£å†³
â””â”€â”€ ç”¨æˆ·æ‰‹åŠ¨åˆ·æ–°é€‰é¡¹
```

### 3. **æ€§èƒ½ç“¶é¢ˆé£é™©**
```
ç¼ºé™·ï¼šè·¨ç³»ç»ŸæŸ¥è¯¢å¯èƒ½è¾ƒæ…¢
å½±å“ï¼šæœç´¢å’ŒåŠ è½½é€Ÿåº¦ä¸‹é™
ç¼“è§£ï¼š
â”œâ”€â”€ æ™ºèƒ½ç¼“å­˜ç­–ç•¥
â”œâ”€â”€ å¼‚æ­¥åŠ è½½å’Œé¢„å–
â””â”€â”€ åˆ†é¡µå’Œæ‡’åŠ è½½
```

### 4. **æƒé™ç®¡ç†å¤æ‚**
```
ç¼ºé™·ï¼šéœ€è¦åŒæ­¥ä¸¤å¥—æƒé™ç³»ç»Ÿ
å½±å“ï¼šå¯èƒ½å‡ºç°æƒé™ä¸ä¸€è‡´
ç¼“è§£ï¼š
â”œâ”€â”€ ä»¥ Nextcloud æƒé™ä¸ºå‡†
â”œâ”€â”€ PKB æƒé™å®æ—¶åŒæ­¥
â””â”€â”€ æƒé™å†²çªæ—¶çš„é™çº§ç­–ç•¥
```

## ğŸ¯ ä¼˜åŒ–å»ºè®®

### çŸ­æœŸä¼˜åŒ– (1-2ä¸ªæœˆ)
```python
# 1. å®ç°åŸºç¡€çš„ç»Ÿä¸€è§†å›¾
class UnifiedFileService:
    async def get_unified_file_list(self, user_id: str):
        # åˆå¹¶ Nextcloud å’Œ WebUI æ–‡ä»¶
        nextcloud_files = await self.get_nextcloud_files(user_id)
        webui_files = await self.get_webui_files(user_id)
        
        return self.merge_and_enrich_files(nextcloud_files, webui_files)

# 2. æ·»åŠ æ¥æºæ ‡è¯†
class SourceMetadataService:
    def add_source_badges(self, files):
        for file in files:
            file.source_badge = self.generate_source_badge(file.source_type)
```

### ä¸­æœŸä¼˜åŒ– (3-6ä¸ªæœˆ)
```python
# 1. å®ç°å®æ—¶åŒæ­¥
class RealTimeSyncService:
    async def setup_nextcloud_webhook(self, user_id: str):
        # ç›‘å¬ Nextcloud æ–‡ä»¶å˜æ›´
        webhook_url = f"{PKB_BASE_URL}/api/sync/nextcloud/{user_id}"
        await self.nextcloud_client.register_webhook(webhook_url)

# 2. æ™ºèƒ½ç¼“å­˜
class IntelligentCacheService:
    async def cache_user_context(self, user_id: str):
        # é¢„ç¼“å­˜ç”¨æˆ·å¸¸ç”¨æ–‡ä»¶å’Œæœç´¢ç»“æœ
        frequent_files = await self.get_frequent_files(user_id)
        await self.preload_file_content(frequent_files)
```

### é•¿æœŸä¼˜åŒ– (6ä¸ªæœˆ+)
```python
# 1. AI é©±åŠ¨çš„æ™ºèƒ½æ•´ç†
class AIFileOrganizer:
    async def suggest_file_organization(self, user_id: str):
        # åŸºäºç”¨æˆ·è¡Œä¸ºå’Œæ–‡ä»¶å†…å®¹ï¼Œæ™ºèƒ½å»ºè®®æ–‡ä»¶ç»„ç»‡
        user_patterns = await self.analyze_user_patterns(user_id)
        return await self.generate_organization_suggestions(user_patterns)

# 2. è·¨è®¾å¤‡æ™ºèƒ½åŒæ­¥
class SmartSyncService:
    async def intelligent_sync(self, user_id: str, device_context: dict):
        # æ ¹æ®è®¾å¤‡ç±»å‹å’Œç½‘ç»œçŠ¶å†µï¼Œæ™ºèƒ½é€‰æ‹©åŒæ­¥ç­–ç•¥
        sync_strategy = await self.determine_sync_strategy(device_context)
        return await self.execute_sync(user_id, sync_strategy)
```

## ğŸ“Š å®æ–½ä¼˜å…ˆçº§

### é˜¶æ®µè§„åˆ’

```
P0 (ç«‹å³å®æ–½) - åŸºç¡€ç»Ÿä¸€ä½“éªŒï¼š
â”œâ”€â”€ ç»Ÿä¸€æ–‡ä»¶åˆ—è¡¨è§†å›¾ (æ”¯æŒç°æœ‰æ¥æºæ ‡è¯†)
â”œâ”€â”€ æ‰©å±•æ•°æ®ç»“æ„ (Content è¡¨å¢åŠ å¤šæºæ”¯æŒ)
â”œâ”€â”€ åŸºç¡€çš„è·¨æ¥æºæœç´¢
â”œâ”€â”€ ç”¨æˆ·è®¤è¯é›†æˆ (åŸºäº Nextcloud)
â””â”€â”€ æ•°æ®æºç®¡ç†ç•Œé¢

P1 (1-3ä¸ªæœˆ) - æ ¸å¿ƒæ•°æ®æºé›†æˆï¼š
â”œâ”€â”€ ç½‘é¡µçˆ¬å–åŠŸèƒ½ (WebCrawlSyncer)
â”œâ”€â”€ é‚®ä»¶å¯¼å…¥åŠŸèƒ½ (EmailSyncer) 
â”œâ”€â”€ RSS è®¢é˜…ç›‘å¬
â”œâ”€â”€ å®æ—¶åŒæ­¥æœºåˆ¶ä¼˜åŒ–
â”œâ”€â”€ æ™ºèƒ½ç¼“å­˜ç­–ç•¥
â””â”€â”€ ç§»åŠ¨ç«¯ç»Ÿä¸€ç•Œé¢

P2 (3-6ä¸ªæœˆ) - é«˜çº§æ•°æ®æºï¼š
â”œâ”€â”€ åº”ç”¨åŒæ­¥ (Notionã€å¾®ä¿¡ã€é’‰é’‰)
â”œâ”€â”€ æ•°æ®åº“è¿æ¥åŒæ­¥
â”œâ”€â”€ è‡ªåŠ¨åŒ–å·¥å…·é›†æˆ (Zapierã€IFTTT)
â”œâ”€â”€ AI é©±åŠ¨çš„æ–‡ä»¶æ•´ç†
â”œâ”€â”€ ä¸ªæ€§åŒ–æ¨è
â””â”€â”€ è·¨è®¾å¤‡çŠ¶æ€åŒæ­¥

P3 (6ä¸ªæœˆ+) - æ™ºèƒ½åŒ–å¢å¼ºï¼š
â”œâ”€â”€ é«˜çº§æœç´¢åŠŸèƒ½ (å¤šæ¨¡æ€æœç´¢)
â”œâ”€â”€ çŸ¥è¯†å›¾è°±å¯è§†åŒ–
â”œâ”€â”€ æ™ºèƒ½å†…å®¹æ¨è
â”œâ”€â”€ åä½œåŠŸèƒ½å¼€å‘
â”œâ”€â”€ ä¼ä¸šçº§åŠŸèƒ½æ‰©å±•
â””â”€â”€ ç¬¬ä¸‰æ–¹ç”Ÿæ€é›†æˆ
```

### æ•°æ®æºå¼€å‘ä¼˜å…ˆçº§

```
ğŸš€ ç¬¬ä¸€æ‰¹ (P0-P1) - æ ¸å¿ƒæ™ºèƒ½åŠŸèƒ½ï¼š
â”œâ”€â”€ ğŸ” Web å®æ—¶æœç´¢ - AI é—®ç­”æ ¸å¿ƒèƒ½åŠ›ï¼Œç”¨æˆ·åˆšéœ€
â”œâ”€â”€ ğŸ› ï¸ MCP å·¥å…·ç½‘å…³ - å·²æœ‰åŸºç¡€ï¼Œéœ€è¦å®Œå–„å’Œæ‰©å±•
â”œâ”€â”€ ğŸŒ ç½‘é¡µå®šæœŸçˆ¬å– - çŸ¥è¯†åº“æ„å»ºï¼ŒæŠ€æœ¯ç›¸å¯¹ç®€å•
â”œâ”€â”€ ğŸ“§ é‚®ä»¶å¯¼å…¥ - å•†åŠ¡ç”¨æˆ·åˆšéœ€ï¼ŒAPI æˆç†Ÿ
â”œâ”€â”€ ğŸ“¡ RSS è®¢é˜… - å®ç°ç®€å•ï¼Œå†…å®¹è´¨é‡é«˜
â””â”€â”€ ğŸ”„ Nextcloud å¢å¼º - åŸºäºç°æœ‰åŸºç¡€ä¼˜åŒ–

ğŸ“ˆ ç¬¬äºŒæ‰¹ (P2) - å¤šæ¨¡æ€ä¸åº”ç”¨é›†æˆï¼š
â”œâ”€â”€ ğŸ™ï¸ è¯­éŸ³å¤‡å¿˜å½• - ç§»åŠ¨ç«¯æ ¸å¿ƒåŠŸèƒ½ï¼ŒWhisper API æˆç†Ÿ
â”œâ”€â”€ ğŸ“± SMS æ¶ˆæ¯å¯¼å…¥ - ç§»åŠ¨ç«¯æ•°æ®æºï¼Œéšç§å‹å¥½
â”œâ”€â”€ ğŸ“± å¾®ä¿¡èŠå¤©è®°å½• - ä¸­å›½ç”¨æˆ·åˆšéœ€ï¼Œä½†æŠ€æœ¯å¤æ‚
â”œâ”€â”€ ğŸ’¼ é’‰é’‰/ä¼ä¸šå¾®ä¿¡ - ä¼ä¸šç”¨æˆ·ä»·å€¼é«˜
â”œâ”€â”€ ğŸ“ Notion åŒæ­¥ - çŸ¥è¯†å·¥ä½œè€…å¸¸ç”¨
â””â”€â”€ ğŸ“Š æ•°æ®åº“è¿æ¥ - æŠ€æœ¯ç”¨æˆ·éœ€æ±‚

ğŸ”® ç¬¬ä¸‰æ‰¹ (P3) - é«˜çº§åŠŸèƒ½ä¸ç”Ÿæ€ï¼š
â”œâ”€â”€ ğŸ¤– è‡ªåŠ¨åŒ–å·¥å…· (Zapier/IFTTT) - é«˜çº§ç”¨æˆ·éœ€æ±‚
â”œâ”€â”€ ğŸ’¬ Slack/Teams - å›½é™…åŒ–éœ€æ±‚
â”œâ”€â”€ ğŸ“š å…¶ä»–ç¬”è®°åº”ç”¨ (Obsidian/Logseq) - é•¿å°¾éœ€æ±‚
â”œâ”€â”€ ğŸ”Œ è‡ªå®šä¹‰ API å¼€å‘ - å¼€å‘è€…éœ€æ±‚
â”œâ”€â”€ ğŸ¯ æ™ºèƒ½å·¥å…·ç¼–æ’ - å¤æ‚ä»»åŠ¡è‡ªåŠ¨åŒ–
â””â”€â”€ ğŸŒ å¤šè¯­è¨€ä¸å›½é™…åŒ– - å…¨çƒåŒ–æ‰©å±•
```

### æŠ€æœ¯å®ç°è·¯çº¿å›¾

```
Month 1-2: æ™ºèƒ½åŠ©ç†æ ¸å¿ƒ
â”œâ”€â”€ Web å®æ—¶æœç´¢é›†æˆ (Google/Bing API)
â”œâ”€â”€ MCP å·¥å…·ç½‘å…³å®Œå–„å’Œæ‰©å±•
â”œâ”€â”€ æ•°æ®åº“è¡¨ç»“æ„å‡çº§ (æ”¯æŒæ–°æ•°æ®æº)
â”œâ”€â”€ ç»Ÿä¸€ Web æœåŠ¡æ¶æ„ (Search + Crawl)
â””â”€â”€ æ„å›¾è¯†åˆ«å’Œä¸Šä¸‹æ–‡ç®¡ç†

Month 3-4: çŸ¥è¯†åº“å¢å¼º
â”œâ”€â”€ ç½‘é¡µå®šæœŸçˆ¬å–å®Œæ•´å®ç°
â”œâ”€â”€ é‚®ä»¶åŒæ­¥ (Gmail/Outlook)
â”œâ”€â”€ RSS è®¢é˜…ç›‘å¬
â”œâ”€â”€ å®æ—¶åŒæ­¥ä¼˜åŒ–
â””â”€â”€ æœç´¢ç»“æœæ™ºèƒ½ä¿å­˜æœºåˆ¶

Month 5-6: å¤šæ¨¡æ€è¾“å…¥
â”œâ”€â”€ è¯­éŸ³å¤‡å¿˜å½• (Whisper é›†æˆ)
â”œâ”€â”€ SMS æ¶ˆæ¯å¯¼å…¥
â”œâ”€â”€ åº”ç”¨åŒæ­¥æ¡†æ¶
â”œâ”€â”€ Notion é€‚é…å™¨
â””â”€â”€ ç§»åŠ¨ç«¯å¤šæ¨¡æ€ç•Œé¢

Month 7-9: é«˜çº§é›†æˆ
â”œâ”€â”€ å¾®ä¿¡æ•°æ®å¯¼å…¥
â”œâ”€â”€ é’‰é’‰/ä¼ä¸šå¾®ä¿¡é›†æˆ
â”œâ”€â”€ æ•°æ®åº“è¿æ¥åŒæ­¥
â”œâ”€â”€ æ™ºèƒ½å·¥å…·ç¼–æ’
â””â”€â”€ å¤æ‚ä»»åŠ¡è‡ªåŠ¨åŒ–

Month 10-12: ç”Ÿæ€ä¸æ™ºèƒ½åŒ–
â”œâ”€â”€ è‡ªåŠ¨åŒ–å·¥å…·é›†æˆ (Zapier/IFTTT)
â”œâ”€â”€ AI å†…å®¹åˆ†æå¢å¼º
â”œâ”€â”€ çŸ¥è¯†å›¾è°±æ„å»º
â”œâ”€â”€ ä¸ªæ€§åŒ–æ¨è
â”œâ”€â”€ ä¼ä¸šçº§åŠŸèƒ½
â””â”€â”€ å¤šè¯­è¨€å›½é™…åŒ–
```

### å…³é”®æŠ€æœ¯å†³ç­–

#### Web Search vs Web Crawl ç»Ÿä¸€ç­–ç•¥
```
å†³ç­–ï¼šåŒè½¨å¹¶è¡Œï¼Œç»Ÿä¸€å…¥å£
ç†ç”±ï¼š
â”œâ”€â”€ æ»¡è¶³ä¸åŒç”¨æˆ·åœºæ™¯ (å³æ—¶é—®ç­” vs çŸ¥è¯†æ„å»º)
â”œâ”€â”€ æŠ€æœ¯æ¶æ„å¯å¤ç”¨ (HTTP å®¢æˆ·ç«¯ã€å†…å®¹è§£æ)
â”œâ”€â”€ æ•°æ®ä»·å€¼æœ€å¤§åŒ– (æœç´¢ç»“æœå¯é€‰æ‹©æ€§ä¿å­˜)
â””â”€â”€ ç”¨æˆ·ä½“éªŒä¸€è‡´ (ç»Ÿä¸€ç•Œé¢ï¼Œæ™ºèƒ½è·¯ç”±)

å®æ–½ï¼š
â”œâ”€â”€ ç»Ÿä¸€ WebService ä½œä¸ºå…¥å£
â”œâ”€â”€ åŸºäºç”¨æˆ·æ„å›¾æ™ºèƒ½è·¯ç”±
â”œâ”€â”€ æœç´¢ç»“æœæ”¯æŒä¸€é”®ä¿å­˜åˆ°çŸ¥è¯†åº“
â””â”€â”€ çˆ¬å–å†…å®¹è‡ªåŠ¨è¿›å…¥çŸ¥è¯†åº“
```

#### MCP Tool é›†æˆç­–ç•¥
```
å†³ç­–ï¼šæ¸è¿›å¼æ‰©å±•ï¼Œä¿æŒå…¼å®¹
ç†ç”±ï¼š
â”œâ”€â”€ ç°æœ‰ MCP åŸºç¡€è®¾æ–½å·²ç»å­˜åœ¨
â”œâ”€â”€ å·¥å…·ç”Ÿæ€éœ€è¦é€æ­¥å»ºè®¾
â”œâ”€â”€ ç”¨æˆ·å­¦ä¹ æˆæœ¬éœ€è¦æ§åˆ¶
â””â”€â”€ æŠ€æœ¯é£é™©éœ€è¦åˆ†æ•£

å®æ–½ï¼š
â”œâ”€â”€ ä¼˜å…ˆå®Œå–„ç°æœ‰ MCP å·¥å…·
â”œâ”€â”€ é€æ­¥æ·»åŠ æ–°çš„å·¥å…·ç±»åˆ«
â”œâ”€â”€ å»ºç«‹å·¥å…·ç¼–æ’å’Œåä½œæœºåˆ¶
â””â”€â”€ æä¾›å¯è§†åŒ–å·¥å…·ç®¡ç†ç•Œé¢
```

## ğŸ‰ æ€»ç»“

### âœ… **æ ¸å¿ƒä¼˜åŠ¿**

**ğŸ§  æ™ºèƒ½åŠ©ç†èƒ½åŠ›**ï¼š
â”œâ”€â”€ Web å®æ—¶æœç´¢ + çŸ¥è¯†åº“æŸ¥è¯¢çš„æ··åˆé—®ç­”
â”œâ”€â”€ MCP å·¥å…·ç½‘å…³æ”¯æŒå¤æ‚ä»»åŠ¡ç¼–æ’
â”œâ”€â”€ å¤šæ¨¡æ€è¾“å…¥ (æ–‡æœ¬ã€è¯­éŸ³ã€å›¾ç‰‡ã€æ–‡ä»¶)
â””â”€â”€ ä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„æ™ºèƒ½è·¯ç”±å’Œå†³ç­–

**ğŸ“š çŸ¥è¯†åº“æ„å»º**ï¼š
â”œâ”€â”€ å¤šæºæ•°æ®è‡ªåŠ¨é‡‡é›† (çˆ¬å–ã€é‚®ä»¶ã€åº”ç”¨åŒæ­¥)
â”œâ”€â”€ AI é©±åŠ¨çš„å†…å®¹åˆ†æå’Œåˆ†ç±»
â”œâ”€â”€ ç»Ÿä¸€çš„å‘é‡åŒ–å’Œè¯­ä¹‰æœç´¢
â””â”€â”€ è·¨è®¾å¤‡çš„çŸ¥è¯†åŒæ­¥å’Œè®¿é—®

**ğŸ”„ ç»Ÿä¸€ä½“éªŒ**ï¼š
â”œâ”€â”€ ä¸€ä¸ªç•Œé¢å¤„ç†æ‰€æœ‰çŸ¥è¯†å’Œä»»åŠ¡
â”œâ”€â”€ æ™ºèƒ½æ„å›¾è¯†åˆ«ï¼Œè‡ªåŠ¨é€‰æ‹©æœ€ä½³ç­–ç•¥
â”œâ”€â”€ æœç´¢ç»“æœå¯é€‰æ‹©æ€§ä¿å­˜åˆ°çŸ¥è¯†åº“
â””â”€â”€ å·¥å…·è°ƒç”¨ç»“æœè‡ªåŠ¨æ•´åˆåˆ°å¯¹è¯ä¸­

### ğŸ¯ **å…³é”®åˆ›æ–°ç‚¹**

**1. Web Search + Web Crawl åŒè½¨è®¾è®¡**
```
å³æ—¶é—®ç­”: Web Search â†’ ä¸´æ—¶ç»“æœ â†’ å¯é€‰ä¿å­˜
çŸ¥è¯†æ„å»º: Web Crawl â†’ è‡ªåŠ¨ä¿å­˜ â†’ æŒç»­ç›‘æ§
```

**2. MCP Tool æ™ºèƒ½ç¼–æ’**
```
ç®€å•é—®é¢˜: ç›´æ¥é—®ç­”
å¤æ‚ä»»åŠ¡: å·¥å…·é“¾ç¼–æ’ â†’ åˆ†æ­¥æ‰§è¡Œ â†’ ç»“æœæ•´åˆ
```

**3. å¤šæ¨¡æ€ç»Ÿä¸€æ¥å…¥**
```
æ–‡æœ¬ â†’ è¯­éŸ³ â†’ å›¾ç‰‡ â†’ æ–‡ä»¶ â†’ åº”ç”¨æ•°æ®
     â†“
  ç»Ÿä¸€å¤„ç†æµæ°´çº¿
     â†“
  çŸ¥è¯†åº“ + å³æ—¶å›ç­”
```

### ğŸš€ **å®æ–½å»ºè®®**

**ç«‹å³å¼€å§‹ (Month 1-2)**ï¼š
- Web å®æ—¶æœç´¢é›†æˆ (æ ¸å¿ƒ AI èƒ½åŠ›)
- MCP å·¥å…·ç½‘å…³å®Œå–„ (å·²æœ‰åŸºç¡€)
- ç»Ÿä¸€ Web æœåŠ¡æ¶æ„

**å¿«é€Ÿè¿­ä»£ (Month 3-6)**ï¼š
- ç½‘é¡µçˆ¬å– + é‚®ä»¶å¯¼å…¥
- è¯­éŸ³å¤‡å¿˜å½• + SMS å¯¼å…¥
- ç§»åŠ¨ç«¯å¤šæ¨¡æ€ç•Œé¢

è¿™ä¸ªæ¶æ„å°† PKB ä»**ä¸ªäººçŸ¥è¯†åº“**å‡çº§ä¸º**å…¨èƒ½æ™ºèƒ½åŠ©ç†**ï¼Œæ˜¯ä¸‹ä¸€ä»£çŸ¥è¯†ç®¡ç†ç³»ç»Ÿçš„ç†æƒ³å½¢æ€ï¼ğŸ¯
